aov.out2 <- tibble::rownames_to_column(aov.out, "comparison")
aov.out2$type="bwpd"
#
aov.out = aov(pc1 ~ Cohort, data=df1_sub)
res <- TukeyHSD(aov.out)
aov.out <- as.data.frame(res$Cohort)
aov.out3 <- tibble::rownames_to_column(aov.out, "comparison")
aov.out3$type="pc1"
#
aov.out = aov(pc2 ~ Cohort, data=df1_sub)
res <- TukeyHSD(aov.out)
aov.out <- as.data.frame(res$Cohort)
aov.out4 <- tibble::rownames_to_column(aov.out, "comparison")
aov.out4$type="pc2"
#
aov.out = aov(pc3 ~ Cohort, data=df1_sub)
res <- TukeyHSD(aov.out)
aov.out <- as.data.frame(res$Cohort)
aov.out5 <- tibble::rownames_to_column(aov.out, "comparison")
aov.out5$type="pc3"
#
aov.out = aov(pc4 ~ Cohort, data=df1_sub)
res <- TukeyHSD(aov.out)
aov.out <- as.data.frame(res$Cohort)
aov.out6 <- tibble::rownames_to_column(aov.out, "comparison")
aov.out6$type="pc4"
#
aov.out = aov(pc5 ~ Cohort, data=df1_sub)
res <- TukeyHSD(aov.out)
aov.out <- as.data.frame(res$Cohort)
aov.out7 <- tibble::rownames_to_column(aov.out, "comparison")
aov.out7$type="pc5"
by_Cohort_t4 <- rbind(aov.out1,
aov.out2,
aov.out3,
aov.out4,
aov.out5,
aov.out6,
aov.out7)
by_Cohort_t4$group = "Cohort_t4"
# by Cohort t5
df1_sub <- df1[df1$collection_date=="t5",]
aov.out = aov(unrooted_pd ~ Cohort, data=df1_sub)
res <- TukeyHSD(aov.out)
aov.out <- as.data.frame(res$Cohort)
aov.out1 <- tibble::rownames_to_column(aov.out, "comparison")
aov.out1$type="unrooted_pd"
#
aov.out = aov(bwpd ~ Cohort, data=df1_sub)
res <- TukeyHSD(aov.out)
aov.out <- as.data.frame(res$Cohort)
aov.out2 <- tibble::rownames_to_column(aov.out, "comparison")
aov.out2$type="bwpd"
#
aov.out = aov(pc1 ~ Cohort, data=df1_sub)
res <- TukeyHSD(aov.out)
aov.out <- as.data.frame(res$Cohort)
aov.out3 <- tibble::rownames_to_column(aov.out, "comparison")
aov.out3$type="pc1"
#
aov.out = aov(pc2 ~ Cohort, data=df1_sub)
res <- TukeyHSD(aov.out)
aov.out <- as.data.frame(res$Cohort)
aov.out4 <- tibble::rownames_to_column(aov.out, "comparison")
aov.out4$type="pc2"
#
aov.out = aov(pc3 ~ Cohort, data=df1_sub)
res <- TukeyHSD(aov.out)
aov.out <- as.data.frame(res$Cohort)
aov.out5 <- tibble::rownames_to_column(aov.out, "comparison")
aov.out5$type="pc3"
#
aov.out = aov(pc4 ~ Cohort, data=df1_sub)
res <- TukeyHSD(aov.out)
aov.out <- as.data.frame(res$Cohort)
aov.out6 <- tibble::rownames_to_column(aov.out, "comparison")
aov.out6$type="pc4"
#
aov.out = aov(pc5 ~ Cohort, data=df1_sub)
res <- TukeyHSD(aov.out)
aov.out <- as.data.frame(res$Cohort)
aov.out7 <- tibble::rownames_to_column(aov.out, "comparison")
aov.out7$type="pc5"
by_Cohort_t5 <- rbind(aov.out1,
aov.out2,
aov.out3,
aov.out4,
aov.out5,
aov.out6,
aov.out7)
by_Cohort_t5$group = "Cohort_t5"
# by Cohort t6
df1_sub <- df1[df1$collection_date=="t6",]
aov.out = aov(unrooted_pd ~ Cohort, data=df1_sub)
res <- TukeyHSD(aov.out)
aov.out <- as.data.frame(res$Cohort)
aov.out1 <- tibble::rownames_to_column(aov.out, "comparison")
aov.out1$type="unrooted_pd"
#
aov.out = aov(bwpd ~ Cohort, data=df1_sub)
res <- TukeyHSD(aov.out)
aov.out <- as.data.frame(res$Cohort)
aov.out2 <- tibble::rownames_to_column(aov.out, "comparison")
aov.out2$type="bwpd"
#
aov.out = aov(pc1 ~ Cohort, data=df1_sub)
res <- TukeyHSD(aov.out)
aov.out <- as.data.frame(res$Cohort)
aov.out3 <- tibble::rownames_to_column(aov.out, "comparison")
aov.out3$type="pc1"
#
aov.out = aov(pc2 ~ Cohort, data=df1_sub)
res <- TukeyHSD(aov.out)
aov.out <- as.data.frame(res$Cohort)
aov.out4 <- tibble::rownames_to_column(aov.out, "comparison")
aov.out4$type="pc2"
#
aov.out = aov(pc3 ~ Cohort, data=df1_sub)
res <- TukeyHSD(aov.out)
aov.out <- as.data.frame(res$Cohort)
aov.out5 <- tibble::rownames_to_column(aov.out, "comparison")
aov.out5$type="pc3"
#
aov.out = aov(pc4 ~ Cohort, data=df1_sub)
res <- TukeyHSD(aov.out)
aov.out <- as.data.frame(res$Cohort)
aov.out6 <- tibble::rownames_to_column(aov.out, "comparison")
aov.out6$type="pc4"
#
aov.out = aov(pc5 ~ Cohort, data=df1_sub)
res <- TukeyHSD(aov.out)
aov.out <- as.data.frame(res$Cohort)
aov.out7 <- tibble::rownames_to_column(aov.out, "comparison")
aov.out7$type="pc5"
by_Cohort_t6 <- rbind(aov.out1,
aov.out2,
aov.out3,
aov.out4,
aov.out5,
aov.out6,
aov.out7)
by_Cohort_t6$group = "Cohort_t6"
# by Cohort t7
df1_sub <- df1[df1$collection_date=="t7",]
aov.out = aov(unrooted_pd ~ Cohort, data=df1_sub)
res <- TukeyHSD(aov.out)
aov.out <- as.data.frame(res$Cohort)
aov.out1 <- tibble::rownames_to_column(aov.out, "comparison")
aov.out1$type="unrooted_pd"
#
aov.out = aov(bwpd ~ Cohort, data=df1_sub)
res <- TukeyHSD(aov.out)
aov.out <- as.data.frame(res$Cohort)
aov.out2 <- tibble::rownames_to_column(aov.out, "comparison")
aov.out2$type="bwpd"
#
aov.out = aov(pc1 ~ Cohort, data=df1_sub)
res <- TukeyHSD(aov.out)
aov.out <- as.data.frame(res$Cohort)
aov.out3 <- tibble::rownames_to_column(aov.out, "comparison")
aov.out3$type="pc1"
#
aov.out = aov(pc2 ~ Cohort, data=df1_sub)
res <- TukeyHSD(aov.out)
aov.out <- as.data.frame(res$Cohort)
aov.out4 <- tibble::rownames_to_column(aov.out, "comparison")
aov.out4$type="pc2"
#
aov.out = aov(pc3 ~ Cohort, data=df1_sub)
res <- TukeyHSD(aov.out)
aov.out <- as.data.frame(res$Cohort)
aov.out5 <- tibble::rownames_to_column(aov.out, "comparison")
aov.out5$type="pc3"
#
aov.out = aov(pc4 ~ Cohort, data=df1_sub)
res <- TukeyHSD(aov.out)
aov.out <- as.data.frame(res$Cohort)
aov.out6 <- tibble::rownames_to_column(aov.out, "comparison")
aov.out6$type="pc4"
#
aov.out = aov(pc5 ~ Cohort, data=df1_sub)
res <- TukeyHSD(aov.out)
aov.out <- as.data.frame(res$Cohort)
aov.out7 <- tibble::rownames_to_column(aov.out, "comparison")
aov.out7$type="pc5"
by_Cohort_t7 <- rbind(aov.out1,
aov.out2,
aov.out3,
aov.out4,
aov.out5,
aov.out6,
aov.out7)
by_Cohort_t7$group = "Cohort_t7"
# by Cohort i6
df1_sub <- df1[df1$collection_date=="t8",]
aov.out = aov(unrooted_pd ~ Cohort, data=df1_sub)
res <- TukeyHSD(aov.out)
aov.out <- as.data.frame(res$Cohort)
aov.out1 <- tibble::rownames_to_column(aov.out, "comparison")
aov.out1$type="unrooted_pd"
#
aov.out = aov(bwpd ~ Cohort, data=df1_sub)
res <- TukeyHSD(aov.out)
aov.out <- as.data.frame(res$Cohort)
aov.out2 <- tibble::rownames_to_column(aov.out, "comparison")
aov.out2$type="bwpd"
#
aov.out = aov(pc1 ~ Cohort, data=df1_sub)
res <- TukeyHSD(aov.out)
aov.out <- as.data.frame(res$Cohort)
aov.out3 <- tibble::rownames_to_column(aov.out, "comparison")
aov.out3$type="pc1"
#
aov.out = aov(pc2 ~ Cohort, data=df1_sub)
res <- TukeyHSD(aov.out)
aov.out <- as.data.frame(res$Cohort)
aov.out4 <- tibble::rownames_to_column(aov.out, "comparison")
aov.out4$type="pc2"
#
aov.out = aov(pc3 ~ Cohort, data=df1_sub)
res <- TukeyHSD(aov.out)
aov.out <- as.data.frame(res$Cohort)
aov.out5 <- tibble::rownames_to_column(aov.out, "comparison")
aov.out5$type="pc3"
#
aov.out = aov(pc4 ~ Cohort, data=df1_sub)
res <- TukeyHSD(aov.out)
aov.out <- as.data.frame(res$Cohort)
aov.out6 <- tibble::rownames_to_column(aov.out, "comparison")
aov.out6$type="pc4"
#
aov.out = aov(pc5 ~ Cohort, data=df1_sub)
res <- TukeyHSD(aov.out)
aov.out <- as.data.frame(res$Cohort)
aov.out7 <- tibble::rownames_to_column(aov.out, "comparison")
aov.out7$type="pc5"
by_Cohort_t8 <- rbind(aov.out1,
aov.out2,
aov.out3,
aov.out4,
aov.out5,
aov.out6,
aov.out7)
by_Cohort_t8$group = "Cohort_t8"
all_padj_Tukey <- rbind(by_cross_breed,
by_LINE,
by_BIRTH_DAY,
by_BIRTH_DAY_Duroc_x_Landrace,
by_BIRTH_DAY_Duroc_x_Large_white,
by_BIRTH_DAY_Large_white_x_Duroc,
by_nurse_sow,
by_maternal_sow,
by_Cohort,
by_Cohort_t0,
by_Cohort_t1,
by_Cohort_t2,
by_Cohort_t3,
by_Cohort_t4,
by_Cohort_t5,
by_Cohort_t6,
by_Cohort_t7,
by_Cohort_t8
)
all_padj_Tukey$test <- "anova"
all_padj_Tukey$padj_method <- "TukeyHSD"
# write out in workbook
addWorksheet(wb, "all_padj_Tukey")
writeData(wb, sheet = "all_padj_Tukey", all_padj_Tukey, rowNames = FALSE)
# plot p-values for start factors
piglets_factors <- all_pvalues %>%
dplyr::filter(grouping != "cohorts" &
grouping != "ctrl_neo" &
grouping != "DScour_ColiGuard" &
grouping != "NeoD_NeoC" &
collection_date != "all")
piglets_factors$grouping <- gsub("birth day - Duroc x Large white",
"birth day - DxLW",piglets_factors$grouping)
piglets_factors$grouping <- gsub("birth day - Duroc x Landrace",
"birth day - DxL",piglets_factors$grouping)
piglets_factors2 <- all_padj_Hommel %>%
filter(grouping != "cohorts" &
grouping != "ctrl_neo" &
grouping != "Dscour_ColiGuard" &
grouping != "NeoD_NeoC" &
collection_date != "all")
piglets_factors2$grouping <- gsub("birth day - Duroc x Large white",
"birth day - DxLW",piglets_factors2$grouping)
piglets_factors2$grouping <- gsub("birth day - Duroc x Landrace",
"birth day - DxL",piglets_factors2$grouping)
unique(piglets_factors$grouping)
unique(piglets_factors2$grouping)
# order to show facets:
piglets_factors$grouping <- factor(piglets_factors$grouping,
levels=c("birth day",
"birth day - DxL",
"birth day - DxLW",
"cross_breed",
"maternal_sow",
"nurse_sow",
"line"))
piglets_factors2$grouping <- factor(piglets_factors2$grouping,
levels=c("birth day",
"birth day - DxL",
"birth day - DxLW",
"cross_breed",
"maternal_sow",
"nurse_sow",
"line"))
# alpha
df <- piglets_factors %>%
pivot_longer(cols=c('unrooted_pd','bwpd'))
colnames(df)[colnames(df)=="name"] <- "parameter"
df2 <- piglets_factors2 %>%
pivot_longer(cols=c('unrooted_pd','bwpd'))
colnames(df2)[colnames(df2)=="name"] <- "parameter"
df$grouping <- gsub(" - ","\n",df$grouping)
df2$grouping <- gsub(" - ","\n",df2$grouping)
df$grouping <- gsub("_","\n",df$grouping)
df2$grouping <- gsub("_","\n",df2$grouping)
# re-order dates
df2$collection_date <- factor(df2$collection_date,
levels=c("t0","t1","t2","t3","t4","t5","t6","t7","t8","t9","t10"))
alpha_plot <- ggplot(df, aes(x=collection_date,y=value)) +
ylim(0,0.06)+
labs(y="alpha diversity - p-value",
x="")+
theme_bw()+
geom_point(data=df2,aes(shape=parameter), color="red", size=2)+
geom_point(aes(shape=parameter), color="black", size=2)+
theme(axis.text.x=element_text(size=3),
axis.text.y=element_text(size=6),
axis.title.x=element_text(size=8),
axis.title.y=element_text(size=8),
legend.position="right",
legend.title = element_text(size = 10),
legend.text = element_text(size = 9))+
facet_grid(~grouping)+
geom_hline(yintercept=0.05, linetype="dashed",
color = "black", size=0.5)
# beta
df <- piglets_factors %>%
pivot_longer(cols=c(contains('pc')))
colnames(df)[colnames(df)=="name"] <- "parameter"
df2 <- piglets_factors2 %>%
pivot_longer(cols=c(contains('pc')))
colnames(df2)[colnames(df2)=="name"] <- "parameter"
df$grouping <- gsub(" - ","\n",df$grouping)
df2$grouping <- gsub(" - ","\n",df2$grouping)
df$grouping <- gsub("_","\n",df$grouping)
df2$grouping <- gsub("_","\n",df2$grouping)
# re-order dates
df2$collection_date <- factor(df2$collection_date,
levels=c("t0","t1","t2","t3","t4","t5","t6","t7","t8","t9","t10"))
beta_plot <- ggplot(df, aes(x=collection_date,y=value)) +
ylim(0,0.06)+
labs(y="beta diversity - p-value",
x="")+
theme_bw()+
geom_point(data=df2,aes(shape=parameter), color="red", size=2)+
geom_point(aes(shape=parameter), color="black", size=2)+
theme(axis.text.x=element_text(size=3),
axis.text.y=element_text(size=6),
axis.title.x=element_text(size=8),
axis.title.y=element_text(size=8),
legend.position="right",
legend.title = element_text(size = 10),
legend.text = element_text(size = 9))+
facet_grid(~grouping)+
geom_hline(yintercept=0.05, linetype="dashed",
color = "black", size=0.5)
start_factors_pvalues_plot <- ggarrange(
alpha_plot, beta_plot,ncol=1,nrow=2, labels = c("A","B")
)
pdf(paste0(out_dir,"start_factors_pvalues.pdf"))
start_factors_pvalues_plot
dev.off()
###########################################################################################
# cite packages
sink(paste0(out_dir,"metapigs_base_packages_citations.bib"))
out <- sapply(names(sessionInfo()$otherPkgs),
function(x) print(citation(x), style = "Bibtex"))
sink()
###########################################################################################
###########################################################################################
###########################################################################################
# comment Examiner 3:
# p95 A plot where only p-values are shown.
# Plotting estimates of the diversity indices
# (or the difference in diversity indices)
# along with confidence intervals is vastly preferable.
# EXTRA : as asked by Examiner 3:
head(all_padj_Hommel)
out <- all_padj_Hommel %>%
pivot_longer(cols=3:9) %>%
dplyr::filter(value <= 0.05) %>%
dplyr::filter(!grouping=="birth day - Duroc x Landrace")
head(out)
out$grouping <- gsub(pattern = "line","LINE", out$grouping)
out$grouping <- gsub(pattern = "birth day","BIRTH_DAY", out$grouping)
head(df1)
df1$BIRTH_DAY <- as.character(df1$BIRTH_DAY)
df_final <- data.frame()
for (row in 1:nrow(out)) {
var_to_sel <- out[row,6]
coll_date <- out[row,1]
group_sel <- as.data.frame(out[row,3])
test <- df1[df1$collection_date %in% coll_date,]
test <- test %>%
dplyr::select(group_sel$grouping,isolation_source,collection_date,var_to_sel$name)
test <- as.data.frame(test)
test$id <- paste0("set_",row)
test$grouping <- paste0(as.character(group_sel$grouping))
test$variable=paste0(var_to_sel)
colnames(test) <- c("spec","isolation_source","collection_date","variable_values","id","grouping","variable")
df_final <- rbind(df_final,test)
}
# splitting into multiple dataframes (by set)
multi_df <- split( df_final , f = df_final$id )
plot_me <- function(split_df) {
# df as dataframe
df0 <- as.data.frame(split_df)
# plot
return(print(df0 %>%
ggplot(., aes(x=spec,y=variable_values))+
geom_boxplot(lwd=0.2, outlier.size = 0.5)+
stat_n_text(size = 1.5)+
coord_flip()+
ylab(paste0(df0$variable))+
xlab(paste0(df0$grouping))+
theme(axis.text.y=element_text(size=4, vjust = 0, angle=68),
axis.text.x=element_text(size=4),
axis.title.x=element_text(size=8),
axis.title.y=element_text(size=8))+
facet_grid(~collection_date, scale="free")))
}
p1<-plot_me(df_final %>% dplyr::filter(id=="set_1"))
p2<-plot_me(df_final %>% dplyr::filter(id=="set_2"))
p3<-plot_me(df_final %>% dplyr::filter(id=="set_3"))
p4<-plot_me(df_final %>% dplyr::filter(id=="set_4"))
p5<-plot_me(df_final %>% dplyr::filter(id=="set_5"))
p6<-plot_me(df_final %>% dplyr::filter(id=="set_6"))
p7<-plot_me(df_final %>% dplyr::filter(id=="set_7"))
#plot_me(df_final %>% dplyr::filter(id=="set_8"))  # this one is already plotted in a suppl. figure
#plot_me(df_final %>% dplyr::filter(id=="set_9"))  # this one is already plotted in a suppl. figure
#plot_me(df_final %>% dplyr::filter(id=="set_10"))  # this one is already plotted in a suppl. figure
# extra plot:
out2 <- all_padj_Hommel %>%
pivot_longer(cols=3:9) %>%
dplyr::filter(value <= 0.05) %>%
dplyr::filter(grouping=="birth day - Duroc x Landrace")
head(out2)
p8<-df1 %>%
dplyr::filter(cross_breed=="Duroc x Landrace") %>%
dplyr::filter(collection_date=="t2") %>%
dplyr::select(isolation_source,pc2,BIRTH_DAY,collection_date,cross_breed) %>%
ggplot(., aes(x=BIRTH_DAY,y=pc2))+
geom_boxplot(lwd=0.2, outlier.size = 0.5)+
stat_n_text(size = 1.5)+
coord_flip()+
theme(axis.text.y=element_text(size=4, vjust = 0, angle=68),
axis.text.x=element_text(size=4),
axis.title.x=element_text(size=8),
axis.title.y=element_text(size=8))+
facet_grid(~collection_date, scale="free")
# put them together:
sign_plots <- ggarrange(p1,p2,p3,p4,
p5,
#p6,p7, # these are the mothers (already plotted in other plots)
p8,
ncol = 4, nrow=2)
pdf(paste0(out_dir,"start_factors_pvalues_boxplots.pdf"))
sign_plots
dev.off()
merged_sign_plots <- ggarrange(start_factors_pvalues_plot,
sign_plots, labels = c("","C"),
ncol = 1, nrow=2)
pdf(paste0(out_dir,"start_factors_pvalues_merged.pdf"))
merged_sign_plots
dev.off()
CI_me <- function(split_df) {
# df as dataframe
df0 <- as.data.frame(split_df)
# plot
return(df0 %>%
group_by(id,collection_date,grouping,variable,spec) %>%
dplyr::summarise(mean.variable_values = mean(variable_values, na.rm = TRUE),
sd.variable_values = sd(variable_values, na.rm = TRUE),
n.variable_values = n()) %>%
dplyr::mutate(se.variable_values = sd.variable_values / sqrt(n.variable_values),
lower.ci.variable_values = mean.variable_values - qt(1 - (0.05 / 2), n.variable_values - 1) * se.variable_values,
upper.ci.variable_values = mean.variable_values + qt(1 - (0.05 / 2), n.variable_values - 1) * se.variable_values)
)
}
CIs <- rbind(as.data.frame(CI_me(df_final %>% dplyr::filter(id=="set_1"))),
as.data.frame(CI_me(df_final %>% dplyr::filter(id=="set_2"))),
as.data.frame(CI_me(df_final %>% dplyr::filter(id=="set_3"))),
as.data.frame(CI_me(df_final %>% dplyr::filter(id=="set_4"))),
as.data.frame(CI_me(df_final %>% dplyr::filter(id=="set_5"))),
as.data.frame(CI_me(df_final %>% dplyr::filter(id=="set_6"))),
as.data.frame(CI_me(df_final %>% dplyr::filter(id=="set_7"))),
as.data.frame(CI_me(df_final %>% dplyr::filter(id=="set_8"))),
as.data.frame(CI_me(df_final %>% dplyr::filter(id=="set_9"))),
as.data.frame(CI_me(df_final %>% dplyr::filter(id=="set_10"))))
# write out in workbook
addWorksheet(wb, "confidence_intervals")
writeData(wb, sheet = "confidence_intervals", CIs, rowNames = FALSE)
######################################################################################################
######################################################################################################
######################################################################################################
# save stats in workbook
saveWorkbook(wb, paste0(out_dir_git,"stats.xlsx"), overwrite=TRUE)
###########################################################################################
